# 浏览器内核之---V8 引擎[[22.浏览器渲染原理]]
浏览器内核由渲染引擎 (html+css) 和 js 引擎 (解析 js 代码) 两部分组成
V8 引擎是 js 引擎中的优秀代表

## V8 执行原理
[V8 JavaScript engine](https://v8.dev/)
V8 是用 C ++编写的 Google 开源高性能 JavaScript 和 WebAssembly 引擎 
V8 可以独立运行，也可以嵌入到任何 C ++应用程序中
![[Pasted image 20220608025221.png]]
## 架构
- parse 解析
	- 会将 JavaScript 代码转换成 AST（抽象语法树）
	- 如果函数没有被调用，不会被转换成 AST 
- Ignition 点火装置/解释器
	- 解释器, 将 AST 转换成 ByteCode（字节码）
	- 收集 TurboFan 优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）
	- 如果函数只调用一次，Ignition 会解释执行 ByteCode；
- TurboFan 涡轮扇 (增速)
	- 编译器，可以将字节码编译为 CPU 可以直接执行的机器码；
	- 如果一个函数被多次调用，那么就会被标记为热点函数，那么就会经过 TurboFan 转换成优化的机器码，提高代码的执行性能；
	- 若之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码；(如 sum 函数原来执行的是 number 类型，后来执行变成了 string 类型 ), 此时机器码就会被还原为字节码 
## 词法/语法分析
- 词法分析（ lexical analysis/scanner）
	将字符序列转换成 token 序列的过程。
- 记号化 (token/tokenization)
- 语法分析（syntactic analysis/ parsing/parser）
![[Pasted image 20220608024336.png]]
blink 加载文档流后, scanner 将每一个句子拆分为一个个单独的字词, 并将其 token 化, 形成一个个被标记的词,  parse 根据被标记的词的意思并将其拼接进行语法分析, 形成 AST, 然后转为字节码 